include header.doc
<!-- @(#) $Id$ -->

<h2>
Reference
</h2>

include hr.doc

<table>
<tr>
<td>
<a href="#softreq"/>Software Requirements</a>
</td>
</tr>

<tr>
<td>
<a href="#usage"/>Usage</a>
</td>
</tr>

<tr>
<td>
<a href="#language"/>Language and Commands</a>
</td>
</tr>
</table>
<p>

include hr.doc

<a name="softreq"></a>
<h3>Software Requirements</h3>

Mapyrus requires:
<ol>
<li>
Java Runtime Environment 1.4.1
</li>
<li>
The Ghostscript PostScript interpreter from 
<a href="http://www.aladdin.com">www.aladdin.com</a>,
if creation of PDF files is required.
</li>
<li>
The PROJ.4 library from
<a href="http://www.remotesensing.org">www.remotesensing.org</a>
and a Java Native Interface shared library to the PROJ.4
library for your operating system,
if reprojection between coordinate systems is required.
</li>
</ol>

include hr.doc

<a name="usage"></a>
<h3>Usage</h3>

text files or URLs of text filename

<pre>
$ java -jar mapyrus.jar myfile.txt
</pre>

The purpose of Mapyrus is to display
A page is 

path

dataset
fetch each record
<a href="#fetch">fetch</a>
tests control display

worlds
Coordinate values in a dataset are given in a coordinate system.
such as Universal Transverse Mercator (UTM)
projected onto the page

include hr.doc

<a name="language"></a>
<h3>Language and Commands</h3>

Mapyrus interprets commands read from one or more plain text files.
Each command is given on a separate line.
<p>
Any part of a line following a hash (<tt>#</tt>) character that is not
part of a literal string is interpreted as a comment and is ignored.
<p>
Each command is passed zero or more arguments separated by commas.
An argument is a number, a string literal in single quotes (<tt>'</tt>)
or double quotes (<tt>"</tt>), a variable name, or an expression.
<p>
An expression contains arguments and operators and functions
on those arguments, just like in other languages such as BASIC, C, or Python.
The following operators and functions are available:
<p>

<table border=1 width=300>
<tr>

<td>
<b>Operator</b>
</td>
<td>
<b>Description</b>
</td>

</tr>
<tr>

<td>
<tt>(</tt>, <tt>)</tt>
</td>
<td>
parentheses
</td>


</tr>
<tr>

<td>
<tt>*</tt>, <tt>/</tt>, <tt>x</tt>
</td>
<td>
numeric multiplication, numeric division, string repetition
</td>

</tr>
<tr>

<td>
<tt>+</tt>, <tt>-</tt>, <tt>.</tt>
</td>
<td>
numeric addition, numeric subtraction, string concatenation
</td>

</tr>
<tr>

<td>
<tt>&lt;=</tt>, <tt>&lt;</tt>, <tt>==</tt>,
<tt>!=</tt>, <tt>&gt</tt>, <tt>&gt;=</tt>,
<tt>lt</tt>, <tt>le</tt>, <tt>eq</tt>,
<tt>ne</tt>, <tt>gt</tt>, <tt>ge</tt>
</td>
<td>
numeric comparisons and string comparisons
</td>

</tr>
<tr>

<td>
<tt>and</tt>
</td>
<td>
Logical and
</td>

</tr>
<tr>

<td>
<tt>or</tt>
</td>
<td>
Logical or
</td>

</tr>
</table>

<p>
<table border=1 width=500>
<tr>
<td>
<b>Function Name</b>
<td>
<b>Description</b>

<tr>
<td>
<a name="length"></a>
<tt>length(<i>str</i>)<tt>
<td>
Returns the length of the string <i>str</i>.

<tr>
<td>
<a name="match"></a>
<tt>match(<i>str</i>, <i>regex</i>)<tt>
<td>
Returns the index in the string <i>str</i>, where the regular expression
<i>regex</i> is first matched.  The index of the first character is 1.
If the regular expression does not match <i>str</i>, then 0 is returned.

<tr>
<td>
<a name="round"></a>
<tt>round(<i>n</i>)<tt>
<td>
Returns <i>n</i> rounded to nearest whole number.

<tr>
<td>
<a name="random"></a>
<tt>random(<i>n</i>)<tt>
<td>
Generates a random floating point number between 0 and <i>n</i>.

<tr>
<td>
<a name="substr"></a>
<tt>substr(<i>str</i>, <i>offset</i>, <i>n</i>)<tt>
<td>
Returns a substring of the string <i>str</i>, beginning at the
character with index <i>offset</i> that is <i>n</i> characters long.
The first character in <i>str</i> has an index of 1.

</table>

<p>
An arguments or expression is  assigned to a named variable using the equals
sign (<tt>=</tt>).  A variable name begins with a
letter or dollar sign (<tt>$</tt>) and contains only letters, numbers,
dots (<tt>.</tt>) and underbars (<tt>_</tt>).
Variable names are case-sensitive.
Variables that are referenced without having been defined have a
value of zero, or an empty string.
<p>

The <tt>if</tt> and <tt>while</tt> flow control structures
found in other languages are available:
<p>

<tt>if</tt> <i>condition</i> <tt>then</tt>
<br>
&nbsp;&nbsp;<i>then commands</i> ...
<br>
<tt>else</tt>
<br>
&nbsp;&nbsp;<i>else commands</i> ...
<br>
<tt>endif</tt>

<p>
Executes <i>then commands</i> if <i>condition</i> evaluates to
a non-zero value, otherwise <i>else commands</i> are executed.
The <tt>else</tt> part is optional.
Compound tests are built using the <tt>elif</tt> keyword:
<p>

<tt>if</tt> <i>condition</i> <tt>then</tt>
<br>
&nbsp;&nbsp;<i>commands</i> ...
<br>
<tt>elif</tt> <i>condition</i> <tt>then</tt>
<br>
&nbsp;&nbsp;<i>commands</i> ...
<br>
<tt>endif</tt>

<p>

The <tt>while</tt> keyword defines a loop in which
<i>commands</i> will be executed for as long
as <i>condition</i> continues to evaluate to a non-zero value:
<p>

<tt>while</tt> <i>condition</i> <tt>do</tt>
<br>
&nbsp;&nbsp;<i>commands</i> ...
<br>
<tt>done</tt>

<p>

procedures
<p>
<tt>begin</tt> <i>name</i> [<i>arg1</i>, ...]
<br>
&nbsp;&nbsp;<i>commands</i> ...
<br>
<tt>end</tt>
<p>
Save context
variables
graphics state, path, clip path
restored at <tt>end</tt>
special moveto behaviour
must be called with correct number of arguments.

datasets
world coordinates

Precedence from highest to lowest


<p>
<table border=1>

<tr>
<td>
<b>Variable Name</b>
<td>
<b>Description</b>

<tr>
<td>
<tt>Mapyrus.dataset.fieldnames</tt>
<td>
The names of fields being imported from the current dataset,
separated by spaces.
<tr>
<td>
<tt>Mapyrus.dataset.projection</tt>
<td>
A description of the projection (coordinate system) in which coordinates
of the current dataset are stored.
Projection descriptions are not standardised between dataset formats.
Different dataset formats will return different descriptions for the same
projection.

<tr>
<td>
<tt>Mapyrus.dataset.min.x</tt>
<br>
<tt>Mapyrus.dataset.min.y</tt>
<br>
<tt>Mapyrus.dataset.max.x</tt>
<br>
<tt>Mapyrus.dataset.max.y</tt>
<td>
The bounding rectangle of all data in the current dataset.

<tr>
<td>
<tt>Mapyrus.elapsedtime</tt>
<td>
The elapsed processing time, measured in seconds.

<tr>
<td>
<tt>Mapyrus.geometry.length</tt>
<td>
The length of the current path on the page, measured in millimetres.

<tr>
<td>
<tt>Mapyrus.geometry.area</tt>
<td>
The area of the current path on the page, measured in square millimetres.

<tr>
<td>
<tt>Mapyrus.import.count</tt>
<td>
The number of rows already fetched from the current dataset.

<tr>
<td>
<tt>Mapyrus.import.moreRows</tt>
<td>
Flag value set to 1 if another row is available for <a href="#fetch">fetch</a>
command, or 0 if no more rows available.

<tr>
<td>
<tt>Mapyrus.page.height</tt>
<br>
<tt>Mapyrus.page.width</tt>
<br>
<tt>Mapyrus.page.resolution</tt>
<td>
The height, width and resolution of page that were given to
<a href="#newpage">newpage</a> command.  Height and width are
in millimetres, resolution is in dots-per-inch.

<tr>
<td>
<tt>Mapyrus.project.min.x</tt>
<br>
<tt>Mapyrus.project.min.y</tt>
<br>
<tt>Mapyrus.project.max.x</tt>
<br>
<tt>Mapyrus.project.max.y</tt>
<td>
The bounding rectangle of world coordinates, in the coordinate
system given as the source projection to the
<a href="#project">project</a> command.

<tr>
<td>
<tt>Mapyrus.rotation</tt>
<td>
The current rotation angle in degrees set by
<a href="#rotate">rotate</a> command.

<tr>
<td>
<tt>Mapyrus.scale.x</tt>
<br>
<tt>Mapyrus.scale.y</tt>
<td>
The current scale factor set by 
<a href="#scale">scale</a> command.

<tr>
<td>
<tt>Mapyrus.timestamp</tt>
<td>
A string representation of the current date and time.

<tr>
<td>
<tt>Mapyrus.version</tt>
<td>
The version of the software.

<tr>
<td>
<tt>Mapyrus.worlds.min.x</tt>
<br>
<tt>Mapyrus.worlds.min.y</tt>
<br>
<tt>Mapyrus.worlds.max.x</tt>
<br>
<tt>Mapyrus.worlds.max.y</tt>
<td>
The bounding rectangle of world coordinates set with the 
<a href="#worlds">worlds</a> command.

<tr>
<td>
<tt>Mapyrus.worlds.scale</tt>
<br>
<td>
The real-world scale factor, determined by
dividing of the X axis coordinate range of world coordinates
by the page width.

</table>
<p>

include hr.doc

<p>
<a name="color"></a>
<tt>color</tt> <i>name</i>
<br>
<tt>color "#</tt><i>hexdigits</i><tt>"</tt>
<br>
<tt>color "rgb"</tt>, <i>red</i>, <i>green</i>, <i>blue</i>
<br>
<tt>color "hsb"</tt>, <i>hue</i>, <i>saturation</i>, <i>brightness</i>
<p>
Sets color for drawing.
Named colors refer to colors in the file
<tt>/usr/lib/X11/rgb.txt</tt>, or the file given 
in the Java system property <tt>Mapyrus.rgbfile</tt>.
<i>hexdigits</i> is a 6 digit hexadecimal value defining RGB values,
as used in HTML pages.
Values for RGB and HSB colors are given as intensities
in the range 0-1.
The spelling <tt>colour</tt> is also accepted for this command.

include hr.doc

<p>
<a name="linestyle"></a>
<tt>linestyle</tt> <i>width</i>
<br>
<tt>linestyle</tt> <i>width</i>, <i>cap</i>, <i>join</i>
<br>
<tt>linestyle</tt> <i>width</i>, <i>cap</i>, <i>join</i>,
<i>phase</i>, <i>dash length</i>, ...
<p>
Sets style line drawing by the <a href="#stroke">stroke</a>
command.
Line <i>width</i> given in millimetres.
<i>cap</i> is the style to use at the ends of lines, either
<tt>butt</tt>, <tt>round</tt> or <tt>square</tt>.
<i>join</i> is the style to use where lines join, either
<tt>bevel</tt>, <tt>miter</tt> or <tt>round</tt>.
One or more <i>dash length</i> values are given, alternating
between the length of one dash and the length of space between
dashes in a dash pattern.  Each <i>dash length</i> is given in millimetres.
<i>phase</i> is the offset in millimetres into the dash pattern 
at which to begin.

include hr.doc

<p>
<a name="font"></a>
<tt>font</tt> <i>name</i>, <i>style</i>, <i>size</i>
<p>
Sets font for labelling with the <a href="#label">label</a> command.
Font <i>name</i> is the name of the font family,
<i>style</i> is either <tt>plain</tt>, <tt>bold</tt>,
<tt>italic</tt> or <tt>bolditalic</tt>.
Font <i>size</i> is given in millimetres.

include hr.doc

<p>
<a name="justify"></a>
justify <i>justification</i>
<p>
Sets justification for labelling with the <a href="#label">label</a> command.
<i>justification</i> is a string containing either
<tt>left</tt>, <tt>right</tt>, <tt>center</tt> for justifying labels
horizontally and/or
<tt>top</tt>, <tt>middle</tt>, <tt>bottom</tt> for justifying labels
vertically.

include hr.doc

<p>
<a name="move"></a>
<tt>move</tt> <i>x</i>, <i>y</i>
<p>
Adds the point (<i>x</i>, <i>y</i>) to the current path.  The
point is first transformed through any world coordinate
transformation set with a <a href="#worlds">worlds</a> command
and then scaled

include hr.doc

<p>
<a name="draw"></a>
<tt>draw</tt> <i>x</i>, <i>y</i>, ...
<p>
Adds one or more straight line segments to the current path.
A straight line segment is added from the previously defined point
to (<i>x</i>, <i>y</i>) and proceeding on through
Points are first transformed through any world coordinate
transformation set with a <a href="#worlds">worlds</a> command.

include hr.doc

<p>
<a name="arc"></a>
<tt>arc</tt> <i>direction</i>, <i>xCenter</i>, <i>yCenter</i>,
<i>xEnd</i>, <i>yEnd</i>
<p>
Adds a circular arc to the current path.  The arc begins at
the last point currently in the path, extend
Circular arc
Extended
If <i>direction</i> is a positive number, the arc travels clockwise,
otherwise the arc travels in an anti-clockwise direction.

include hr.doc

<p>
<a name="clearpath"></a>
<tt>clearpath</tt>
<p>
Removes all points from the current path.

include hr.doc

<p>
<a name="samplepath"></a>
<tt>samplepath</tt> <i>spacing</i>, <i>offset</i>
<p>
Replaces current path with equally spaced points along the path.
<i>offset</i> is the distance along the path at which to place first point,
given in millimetres.
<i>spacing</i> is the distance between points, given in millimetres.
The sign of <i>spacing</i>
controls the direction in which the path is travelled.
If <i>spacing</i> is a positive value, the path is travelled from the
beginning towards the end.
If <i>spacing</i> is a negative value, then the absolute value of
<i>spacing</i> is used and the path is travelled from the end towards
the beginning.
Using a very large postive or negative value for <i>spacing</i> results
in current path being replaced by a single point at the beginning or
end of the path.

include hr.doc

<p>
<a name="stripepath"></a>
<tt>stripepath</tt> <i>spacing</i>, <i>angle</i>
<p>
Replaces current path with equally spaced parallel lines that completely
cover the path.
<i>spacing</i> is the distance between lines, measured in millimetres.
<i>angle</i> is angle of each line, measured in counter-clockwise in
degrees, with zero being horizontal.
Follow this command with a <a href="#clip">clip</a> command to
produce a hatched fill pattern.

<p>
<a name="stroke"></a>
<tt>stroke</tt>

<p>
<a name="fill"></a>
<tt>fill</tt>
Flood fills the current path with the current color.
The winding rule is used for determining the inside and outside
regions of polygons containing islands.
The path is not modified.

include hr.doc

<p>
<a name="protect"></a>
<tt>protect</tt>
Protects

include hr.doc

<p>
<a name="clip"></a>
<tt>clip</tt>
Opposite of protect
Protects
<a href="#protect"/>protect</a>

<p>
<a name="label"></a>
<tt>label</tt> <i>string</i> [, <i>string</i> ...]
<p>
Draws a label at the last point added to the path, using the
font, justification and rotation set with the
<a href="#font"/>font</a>,
<a href="#justify"/>justify</a> and
<a href="#rotate"/>rotate</a>
commands.
If more than one <i>string</i> is given, or a <i>string</i>
contains newline characters (<tt>\n</tt>) then
labels are displayed as multiple lines, one below the other,
with each line justified independently.

<p>
<a name="scale"></a>
SCALE

<p>
<a name="rotate"></a>
ROTATE

<p>
<a name="worlds"></a>
<tt>worlds</tt> <i>x1</i>, <i>y1</i>, <i>x2</i>, <i>y2</i> [, <i>units</i>]
<p>
Defines a world coordinate system.
uniform scaling
<i>units</i>
scale factor
assumed metres.

<p>
<a name="project"></a>
PROJECT

<p>
<a name="dataset"></a>
<tt>dataset</tt> <i>type</i>, <i>name</i>, <i>extras</i>,
[<i>geometryfield</i>, ... ]
<p>

<p>
<a name="import"></a>
IMPORT

<p>
<a name="fetch"></a>
<tt>fetch</tt>
<p>
Fetches next row from current dataset.
A variable with the name of
each column value

<p>
<a name="newpage"></a>
<tt>newpage</tt> <i>format</i>, <i>filename</i>, <i>width</i>,
<i>height</i>, <i>resolution</i>
<p>
Begins output
any previous output file is closed.
<i>resolution</i> is given as a dots-per-inch value.

<p>
<a name="print"></a>
<tt>print</tt> <i>string</i> [, <i>string</i> ...]
<p>
Prints each <i>string</i> to standard output,
separated by spaces.
A newline is added after the final <i>string</i>.
<p>

include footer.doc
